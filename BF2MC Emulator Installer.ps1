$iconBase64 = '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'
$iconBytes = [Convert]::FromBase64String($iconBase64)
# initialize a Memory stream holding the bytes
$iconStream = [System.IO.MemoryStream]::new($iconBytes, 0, $iconBytes.Length)

$folderIconBase64 = 'AAABAAEAIBcAAAEACABkBwAAFgAAACgAAAAgAAAALgAAAAEACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAuf8ARc7/AFrT/wBl1v8AX9f/AGHY/wBi2P8AY9j/AGTZ/wBm2f8AZ9n/AGjZ/wBp2f8AZ9r/AGna/wBq2v8Ab9r/AHbb/wBz3f8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHBwcHCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8PDw8ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODg4ODgsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCwsLCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAwMDAwMDAwMDAwMDEBEGBgYGBgYGBgYGBgYGBgYGBgYAAAAAAAAAAAAAAAAAAhIFBQUFBQUFBQUFBQUFBQUFBQAAAAAAAAAAAAAAAAAAAwwEBAQEBBMEBAQEBAQEEwQTAAAAAAAAAAAAAAAAAAATExMTExMTExMTExMTExMTExMAAAAAAAAAAAAAAAAAExMTExMTExMTExMTExMTExMTEwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEBQAD//8AB///'
$folderIconBytes = [Convert]::FromBase64String($folderIconBase64)
# initialize a Memory stream holding the bytes
$folderIconStream = [System.IO.MemoryStream]::new($folderIconBytes, 0, $folderIconBytes.Length)

$pcsx2Url = "https://github.com/PCSX2/pcsx2/releases/download/v1.7.3858/pcsx2-v1.7.3858-windows-64bit-AVX2-Qt.7z"
$pcsx2PackageName = "pcsx2-v1.7.3858-windows-64bit-AVX2-Qt.7z"
$pcsx2FolderName = "PCSX2-v1_7_3858"

$zip7Url = "https://www.7-zip.org/a/7zr.exe"
$zip7ExeName = "7zr.exe"

$emulatorConfigUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/inis/PCSX2.ini"
$emulatorConfigName = "PCSX2.ini"

$vulkanPatchUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/resources/shaders/vulkan/tfx.glsl"
$vulkanPatchName = "tfx.glsl"

$memcardUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/memcards/BFMCspy.ps2"
$memcardName = "BFMCspy.ps2"

$gamesettingsUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/gamesettings/gamesettings.ini"

$gamecoverUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/covers/cover.png"

$xboxPatchUrl = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/inis/PCSX2.ini"
$xboxPatchName = "c53b0b57f82958c6-dea8033bbc2d19e4-000065d3.png"

Add-Type -Name Window -Namespace Console -MemberDefinition '
[DllImport("Kernel32.dll")]
public static extern IntPtr GetConsoleWindow();

[DllImport("user32.dll")]
public static extern bool ShowWindow(IntPtr hWnd, Int32 nCmdShow);'

[Console.Window]::ShowWindow([Console.Window]::GetConsoleWindow(), 1)
<# 
.NAME
    BF2MC Installer
#>

Add-Type -AssemblyName System.Windows.Forms
[System.Windows.Forms.Application]::EnableVisualStyles()

$MainWindow                       = New-Object system.Windows.Forms.Form
$MainWindow.ClientSize            = New-Object System.Drawing.Point(853,604)
$MainWindow.text                  = "BF2MC Online  |  Emulator Installer"
$MainWindow.TopMost               = $false
$MainWindow.SizeGripStyle         = [System.Windows.Forms.SizeGripStyle]::Hide
$MainWindow.StartPosition         = [System.Windows.Forms.FormStartPosition]::CenterScreen
$MainWindow.FormBorderStyle       = [System.Windows.Forms.FormBorderStyle]::FixedSingle
$MainWindow.MaximizeBox           = $false
$MainWindow.icon                  = [System.Drawing.Icon]::FromHandle(([System.Drawing.Bitmap]::new($iconStream).GetHIcon()))

$panelTop                         = New-Object system.Windows.Forms.Panel
$panelTop.height                  = 95
$panelTop.width                   = 834
$panelTop.location                = New-Object System.Drawing.Point(8,0)
$panelTop.BackColor               = [System.Drawing.ColorTranslator]::FromHtml("#498d9f")

$pictureboxBF2MC                  = New-Object system.Windows.Forms.PictureBox
$pictureboxBF2MC.width            = 165
$pictureboxBF2MC.height           = 86
$pictureboxBF2MC.location         = New-Object System.Drawing.Point(17,2)
$pictureboxBF2MC.imageLocation    = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/images/bf2mc_online_logo.png"
$pictureboxBF2MC.SizeMode         = [System.Windows.Forms.PictureBoxSizeMode]::zoom
$pictureboxBF2MC.BackColor        = [System.Drawing.ColorTranslator]::FromHtml("#498d9f")

$pictureboxBFMCspy                = New-Object system.Windows.Forms.PictureBox
$pictureboxBFMCspy.width          = 229
$pictureboxBFMCspy.height         = 86
$pictureboxBFMCspy.location       = New-Object System.Drawing.Point(280,2)
$pictureboxBFMCspy.imageLocation  = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/images/bfmcspy_logo.png"
$pictureboxBFMCspy.SizeMode       = [System.Windows.Forms.PictureBoxSizeMode]::zoom
$pictureboxBFMCspy.BackColor      = [System.Drawing.ColorTranslator]::FromHtml("#498d9f")

$pictureboxPCSX2                  = New-Object system.Windows.Forms.PictureBox
$pictureboxPCSX2.width            = 229
$pictureboxPCSX2.height           = 86
$pictureboxPCSX2.location         = New-Object System.Drawing.Point(590,2)
$pictureboxPCSX2.imageLocation    = "https://raw.githubusercontent.com/Project-Backstab/BF2MC-Emulator-Installer/main/images/pcsx2_logo.png"
$pictureboxPCSX2.SizeMode         = [System.Windows.Forms.PictureBoxSizeMode]::zoom
$pictureboxPCSX2.BackColor        = [System.Drawing.ColorTranslator]::FromHtml("#498d9f")

$groupboxInfo                     = New-Object system.Windows.Forms.Groupbox
$groupboxInfo.height              = 155
$groupboxInfo.width               = 834
$groupboxInfo.text                = "Hello Soldier!"
$groupboxInfo.location            = New-Object System.Drawing.Point(8,100)

$labelInfo                        = New-Object system.Windows.Forms.Label
$labelInfo.text                   = 
"This installer will download a specific version of the PCSX2 PS2 emulator, and it will modify it to play Battlefield 2: Modern Combat Online (via BFMCspy) with the best possible performance.

If you already have an up-to-date PCSX2 installed, keep it, and choose a different/seperate path below to install this special version. This special version is only designed for BF2:MC Online, and should not be used to play Singleplayer or other PS2 games.

P.S. Sorry if this script seems jank/sketchy; it's the best I could do. Feel free to look at the source code if you're worried.
    <3 Red-Thirten (BFMCspy Staff)"
$labelInfo.AutoSize               = $false
$labelInfo.width                  = 825
$labelInfo.height                 = 125
$labelInfo.location               = New-Object System.Drawing.Point(5,20)
$labelInfo.Font                   = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$groupboxPaths                    = New-Object system.Windows.Forms.Groupbox
$groupboxPaths.height             = 175
$groupboxPaths.width              = 834
$groupboxPaths.text               = "Specify Paths and Region"
$groupboxPaths.location           = New-Object System.Drawing.Point(8,255)

$labelInstallDir                  = New-Object system.Windows.Forms.Label
$labelInstallDir.text             = "Installation Folder:"
$labelInstallDir.AutoSize         = $true
$labelInstallDir.location         = New-Object System.Drawing.Point(5,20)
$labelInstallDir.Font             = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$textboxInstallDir                = New-Object system.Windows.Forms.TextBox
$textboxInstallDir.multiline      = $false
# $textboxInstallDir.text           = [System.IO.Path]::Combine([Environment]::GetFolderPath('MyDocuments'))
$textboxInstallDir.text           = "C:\Users\David\Desktop"
$textboxInstallDir.width          = 500
$textboxInstallDir.height         = 20
$textboxInstallDir.location       = New-Object System.Drawing.Point(10,40)
$textboxInstallDir.Font           = New-Object System.Drawing.Font('Microsoft Sans Serif',10)
# $tooltipInstallDir               = New-Object system.Windows.Forms.ToolTip
# $tooltipInstallDir.ToolTipTitle  = "asdasd"
# $tooltipInstallDir.SetToolTip($textboxInstallDir,'Test')

$buttonInstallDirSelect           = New-Object system.Windows.Forms.Button
$buttonInstallDirSelect.Size      = New-Object Drawing.Size(32, 28)
$buttonInstallDirSelect.Image     = [System.Drawing.Icon]::FromHandle(([System.Drawing.Bitmap]::new($folderIconStream).GetHIcon()))
$buttonInstallDirSelect.location  = New-Object System.Drawing.Point(515,37)
$buttonInstallDirSelect.Add_Click({
    Get-FolderName  -Message "Select a folder to install to. A '$pcsx2FolderName' folder will be added here." -ShowNewFolderButton $true -textBox $textboxInstallDir
})

$labelGamesDir                    = New-Object system.Windows.Forms.Label
$labelGamesDir.text               = "Game Folder:"
$labelGamesDir.AutoSize           = $true
$labelGamesDir.location           = New-Object System.Drawing.Point(5,70)
$labelGamesDir.Font               = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$textboxGamesDir                  = New-Object system.Windows.Forms.TextBox
$textboxGamesDir.multiline        = $false
$textboxGamesDir.text             = $null
$textboxGamesDir.width            = 500
$textboxGamesDir.height           = 20
$textboxGamesDir.location         = New-Object System.Drawing.Point(10,90)
$textboxGamesDir.Font             = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$buttonGamesDirSelect             = New-Object system.Windows.Forms.Button
$buttonGamesDirSelect.Size        = New-Object Drawing.Size(32, 28)
$buttonGamesDirSelect.Image       = [System.Drawing.Icon]::FromHandle(([System.Drawing.Bitmap]::new($folderIconStream).GetHIcon()))
$buttonGamesDirSelect.location    = New-Object System.Drawing.Point(515,87)
$buttonGamesDirSelect.Add_Click({
    Get-FolderName  -Message "Select the folder where your BF2:MC game ISO file is located." -ShowNewFolderButton $false -textBox $textboxGamesDir
})

$labelBiosFile                    = New-Object system.Windows.Forms.Label
$labelBiosFile.text               = "PS2 BIOS .bin File:"
$labelBiosFile.AutoSize           = $true
$labelBiosFile.location           = New-Object System.Drawing.Point(5,120)
$labelBiosFile.Font               = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$textboxBiosFile                  = New-Object system.Windows.Forms.TextBox
$textboxBiosFile.multiline        = $false
$textboxBiosFile.text             = $null
$textboxBiosFile.width            = 500
$textboxBiosFile.height           = 20
$textboxBiosFile.location         = New-Object System.Drawing.Point(10,140)
$textboxBiosFile.Font             = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$buttonBiosFileSelect             = New-Object system.Windows.Forms.Button
$buttonBiosFileSelect.Size        = New-Object Drawing.Size(32, 28)
$buttonBiosFileSelect.Image       = [System.Drawing.Icon]::FromHandle(([System.Drawing.Bitmap]::new($folderIconStream).GetHIcon()))
$buttonBiosFileSelect.location    = New-Object System.Drawing.Point(515,137)
$buttonBiosFileSelect.Add_Click({
    Get-FileName  -Message "Select your BIOS file" -ShowNewFolderButton $false -textBox $textboxBiosFile
})

$comboboxRegion                  = New-Object system.Windows.Forms.ComboBox
$comboboxRegion.width            = 225
$comboboxRegion.height           = 20
@("> Choose your disk's region <",'NTSC [SLUS-21026]','PAL (FR-GR-IT) [SLES-53730]','PAL (JP) [SLPM-55034]') | ForEach-Object {[void] $comboboxRegion.Items.Add($_)}
$comboboxRegion.SelectedIndex    = 0
$comboboxRegion.location         = New-Object System.Drawing.Point(590,90)
$comboboxRegion.Font             = New-Object System.Drawing.Font('Microsoft Sans Serif',10)
$comboboxRegion.DropDownStyle    = [System.Windows.Forms.ComboBoxStyle]::DropDownList

$labelBiosNotice                    = New-Object system.Windows.Forms.Label
$labelBiosNotice.text               = "-> BIOS region MUST match region chosen above!"
$labelBiosNotice.AutoSize           = $true
$labelBiosNotice.location           = New-Object System.Drawing.Point(550,145)
$labelBiosNotice.Font               = New-Object System.Drawing.Font('Microsoft Sans Serif',8)

$groupboxOptions                  = New-Object system.Windows.Forms.Groupbox
$groupboxOptions.height           = 165
$groupboxOptions.width            = 556
$groupboxOptions.text             = "Emulator Options"
$groupboxOptions.location         = New-Object System.Drawing.Point(8,430)

$comboboxResolution                  = New-Object system.Windows.Forms.ComboBox
$comboboxResolution.width            = 225
$comboboxResolution.height           = 20
@("> Render Resolution <",'~480p (Native)','~720p','~1080p (Recommended)','~1440p/2K','~1620p','~2160p/4K (Diminishing Returns)') | ForEach-Object {[void] $comboboxResolution.Items.Add($_)}
$comboboxResolution.SelectedIndex    = 0
$comboboxResolution.location         = New-Object System.Drawing.Point(10,30)
$comboboxResolution.Font             = New-Object System.Drawing.Font('Microsoft Sans Serif',10)
$comboboxResolution.DropDownStyle    = [System.Windows.Forms.ComboBoxStyle]::DropDownList

$checkboxXboxPatch                   = New-Object system.Windows.Forms.CheckBox
$checkboxXboxPatch.text              = "Install Xbox On-Screen buttons texture patch"
$checkboxXboxPatch.AutoSize          = $true
$checkboxXboxPatch.location          = New-Object System.Drawing.Point(10,70)
$checkboxXboxPatch.Font              = New-Object System.Drawing.Font('Microsoft Sans Serif',10)

$buttonInstall                    = New-Object system.Windows.Forms.Button
$buttonInstall.text               = "Install"
$buttonInstall.width              = 162
$buttonInstall.height             = 44
$buttonInstall.visible            = $true
$buttonInstall.enabled            = $true
$buttonInstall.location           = New-Object System.Drawing.Point(630,495)
$buttonInstall.Font               = New-Object System.Drawing.Font('Microsoft Sans Serif',12)
$buttonInstall.Add_Click({ Install-Everything })

$MainWindow.controls.AddRange(@(
    $buttonInstall,
    $groupboxInfo,
    $groupboxOptions,
    $groupboxPaths,
    $panelTop
))
$panelTop.controls.AddRange(@(
    $pictureboxBF2MC,
    $pictureboxBFMCspy,
    $pictureboxPCSX2
))
$groupboxInfo.controls.AddRange(@(
    $labelInfo
))
$groupboxPaths.controls.AddRange(@(
    $labelInstallDir,
    $textboxInstallDir,
    $buttonInstallDirSelect,
    $labelGamesDir,
    $textboxGamesDir,
    $buttonGamesDirSelect,
    $labelBiosFile,
    $textboxBiosFile,
    $buttonBiosFileSelect,
    $comboboxRegion,
    $labelBiosNotice
))
$groupboxOptions.controls.AddRange(@(
    $comboboxResolution,
    $checkboxXboxPatch
))

#region Logic 
function Install-Everything {
    $buttonInstall.enabled = $false
    
    # Show console
    [Console.Window]::ShowWindow([Console.Window]::GetConsoleWindow(), 1)
    Clear-Host
    
    # Download 7zip-standalone
    $zip7FilePath = Join-Path $textboxInstallDir.text $zip7ExeName
    Write-Host "Downloading dependencies..."
    Invoke-WebRequest -Uri $zip7Url -OutFile $zip7FilePath
    
    # Download the PCSX2 .7z file
    $pcsx2FilePath = Join-Path $textboxInstallDir.text $pcsx2PackageName
    Clear-Host
    Write-Host "Downloading PCSX2 v1.7.3858 emulator..."
    Invoke-WebRequest -Uri $pcsx2Url -OutFile $pcsx2FilePath
    
    # Extract PCSX2
    Clear-Host
    Write-Host "Unpacking PCSX2 emulator..."
    $pcsx2InstallPath = Join-Path $textboxInstallDir.text $pcsx2FolderName
    & $zip7FilePath x $pcsx2FilePath -o"$pcsx2InstallPath"
    Remove-Item -Path $zip7FilePath
    Remove-Item -Path $pcsx2FilePath
    Write-Host "Unpacking completed."
    Start-Sleep -Seconds 1

    # Download emulator config
    Clear-Host
    Write-Host "Downloading custom emulator config..."
    $inisPath = Join-Path $pcsx2InstallPath "inis"
    New-Item -ItemType Directory -Path $inisPath
    # $gamesPath = Join-Path $pcsx2InstallPath "games"
    # New-Item -ItemType Directory -Path $gamesPath
    $configPath = Join-Path $inisPath $emulatorConfigName
    Invoke-WebRequest -Uri $emulatorConfigUrl -OutFile $configPath
    Write-Host "Adding preferences to config..."
    (Get-Content -Path $configPath -Raw) -replace "BIOS_DIR", [System.IO.Path]::GetDirectoryName($textboxBiosFile.text) | Set-Content -Path $configPath
    (Get-Content -Path $configPath -Raw) -replace "BIOS_FILE", (Get-Item $textboxBiosFile.text).Name | Set-Content -Path $configPath
    (Get-Content -Path $configPath -Raw) -replace "GAMES_PATH", $textboxGamesDir.text | Set-Content -Path $configPath
    Write-Host "Emulator config done."
    Start-Sleep -Seconds 1

    # Download game settings
    Clear-Host
    Write-Host "Downloading custom game emulation settings..."
    $gamesettingsPath = Join-Path $pcsx2InstallPath "gamesettings"
    New-Item -ItemType Directory -Path $gamesettingsPath
    if ($comboboxRegion.SelectedIndex -eq 1){
        $gamesettingsName = "SLUS-21026_AE1F3139.ini"
    }
    else {
        $gamesettingsName = "error.ini"
    }
    $gamesettingsPath = Join-Path $gamesettingsPath $gamesettingsName
    Invoke-WebRequest -Uri $gamesettingsUrl -OutFile $gamesettingsPath
    Write-Host "Adding preferences to game settings..."
    (Get-Content -Path $gamesettingsPath -Raw) -replace "RESOLUTION_VAL", $comboboxRegion.SelectedIndex | Set-Content -Path $gamesettingsPath
    $gpuName = Get-WmiObject Win32_VideoController | Select-Object -ExpandProperty Name
    (Get-Content -Path $gamesettingsPath -Raw) -replace "GPU_NAME", $gpuName | Set-Content -Path $gamesettingsPath
    Write-Host "Game settings done."
    Start-Sleep -Seconds 1

    # Download Vulkan renderer patch
    Clear-Host
    Write-Host "Downloading Vulkan renderer patch..."
    $vulkanPath = Join-Path $pcsx2InstallPath "resources\shaders\vulkan"
    $vulkanPath = Join-Path $vulkanPath $vulkanPatchName
    Invoke-WebRequest -Uri $vulkanPatchUrl -OutFile $vulkanPath
    Write-Host "Renderer patch done."
    Start-Sleep -Seconds 1

    # Download memcard
    Clear-Host
    Write-Host "Downloading pre-configured PS2 memory card (for connection to BFMCspy)..."
    $memcardsPath = Join-Path $pcsx2InstallPath "memcards"
    New-Item -ItemType Directory -Path $memcardsPath
    $memcardPath = Join-Path $memcardsPath $memcardName
    Invoke-WebRequest -Uri $memcardUrl -OutFile $memcardPath
    Write-Host "Memory card done."
    Start-Sleep -Seconds 1

    # Download game cover
    Clear-Host
    Write-Host "Downloading game cover..."
    $coversPath = Join-Path $pcsx2InstallPath "covers"
    New-Item -ItemType Directory -Path $coversPath
    if ($comboboxRegion.SelectedIndex -eq 1){
        $coverName = "SLUS-21026.png"
    }
    else {
        $coverName = "error.png"
    }
    $coverPath = Join-Path $coversPath $coverName
    Invoke-WebRequest -Uri $gamecoverUrl -OutFile $coverPath
    Write-Host "Game cover done."
    Start-Sleep -Seconds 1

    # Download Xbox buttons patch (if specified)
    if ($checkboxXboxPatch.Checked -eq $true){
        Clear-Host
        Write-Host "Downloading Xbox buttons patch..."
        $replacementsPath = Join-Path $pcsx2InstallPath "textures"
        New-Item -ItemType Directory -Path $replacementsPath
        if ($comboboxRegion.SelectedIndex -eq 1){
            $folderName = "SLUS-21026"
        }
        else {
            $folderName = "error"
        }
        $replacementsPath = Join-Path $replacementsPath $folderName
        New-Item -ItemType Directory -Path $replacementsPath
        $replacementsPath = Join-Path $replacementsPath "replacements"
        New-Item -ItemType Directory -Path $replacementsPath
        $replacementsPath = Join-Path $replacementsPath $xboxPatchName
        Invoke-WebRequest -Uri $xboxPatchUrl -OutFile $replacementsPath
        Write-Host "Xbox buttons patch done."
        Start-Sleep -Seconds 1
    }

    # Hide console
    [Console.Window]::ShowWindow([Console.Window]::GetConsoleWindow(), 0)
}

function Get-FolderName {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory=$true, ValueFromPipeline=$true, ValueFromPipelineByPropertyName=$true, Position=0)]
        [string]$Message = "Select a directory.",

        [bool]$ShowNewFolderButton = $false,
        
        [system.Windows.Forms.TextBox]$textBox = $null
    )

    $browserForFolderOptions = 0x00000041                                  # BIF_RETURNONLYFSDIRS -bor BIF_NEWDIALOGSTYLE
    if (!$ShowNewFolderButton) { $browserForFolderOptions += 0x00000200 }  # BIF_NONEWFOLDERBUTTON

    $browser = New-Object -ComObject Shell.Application
    # To make the dialog topmost, you need to supply the Window handle of the current process
    [intPtr]$handle = [System.Diagnostics.Process]::GetCurrentProcess().MainWindowHandle

    # see: https://msdn.microsoft.com/en-us/library/windows/desktop/bb773205(v=vs.85).aspx
    $folder = $browser.BrowseForFolder($handle, $Message, $browserForFolderOptions)

    $result = $null
    if ($folder) {
        $result = $folder.Self.Path
    }

    # Release and remove the used Com object from memory
    [System.Runtime.Interopservices.Marshal]::ReleaseComObject($browser) | Out-Null
    [System.GC]::Collect()
    [System.GC]::WaitForPendingFinalizers()

    $textBox.text = $result
}

function Get-FileName {
    [CmdletBinding()]
    param (
        [Parameter(Mandatory=$true, ValueFromPipeline=$true, ValueFromPipelineByPropertyName=$true, Position=0)]
        [string]$Message = "Select a file.",

        [bool]$ShowNewFolderButton = $false,
        
        [system.Windows.Forms.TextBox]$textBox = $null
    )

    # Create OpenFileDialog object
    $openFileDialog = New-Object System.Windows.Forms.OpenFileDialog
    $openFileDialog.Title = $Message
    
    # Show the dialog and get the result
    $dialogResult = $openFileDialog.ShowDialog()

    # Check if the user clicked OK
    if ($dialogResult -eq [System.Windows.Forms.DialogResult]::OK) {
        # Return the selected file path
        $textBox.text = $openFileDialog.FileName
    } else {
        # User canceled the selection
        $textBox.text = $null
    }
}

#endregion

[void]$MainWindow.ShowDialog()

# when done, dispose of the stream and form
$iconStream.Dispose()
$folderIconStream.Dispose()
$MainWindow.Dispose()
